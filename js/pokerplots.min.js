const drawBoxPlot=(t,e,a)=>{const n=document.getElementById("main-container"),o=()=>n.clientWidth,l=t=>Math.max(Math.min(100*Math.floor(document.documentElement.clientHeight/100)-200,.65*t),.45*t),r=t=>22*t/1296,s=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),i=t=>(t>=0?"+":"")+s.format(t);let d=t.filter((t=>t.data.length>=5));0===d.length&&(d=t);const m=d.map((t=>{const e=t.data.map((t=>t.delta)),a=d3.quantile(e,.25),n=d3.quantile(e,.5),o=d3.quantile(e,.75),l=o-a,r=d3.max([d3.min(e),a-1.5*l]),s=d3.min([d3.max(e),o+1.5*l]);return{...t,quartiles:[a,n,o],range:[r,s],outliers:e.filter((t=>t<r||t>s)).map((e=>({value:e,name:t.name})))}}));let u=o(),c=l(u),p=r(u);const y=d3.scaleBand().domain(m.map((t=>t.name))).paddingInner(1).paddingOuter(.5).range([a.left,u-a.right]),g=d3.scaleLinear().domain(d3.extent(m.map((t=>[...t.outliers.map((t=>t.value)),...t.range])).flat()).map((t=>1.05*t))).range([c-a.bottom,a.top]),b=d3.select("#"+e).append("svg"),h=d3.select("#"+e).append("div").style("opacity",0).style("position","absolute").attr("class","tooltip"),f=t=>h.style("left",t.pageX+30+"px").style("top",t.pageY-20+"px"),x=()=>h.style("opacity",0),w=(t,e)=>{const a=i(e.range[1]),n=i(e.quartiles[2]),o=i(e.quartiles[1]),l=i(e.quartiles[0]),r=i(e.range[0]);h.style("opacity",.8).html(`<b>${e.name}</b> (N=${e.gameCount})<br><div style="line-height: 135%"><span class="tooltip-boxplot-first-item">max:</span><span class="font-tabular-numbers tooltip-boxplot-second-item">`+a+'</span><br><span class="tooltip-boxplot-first-item">Q<sub>3</sub>:</span><span class="font-tabular-numbers tooltip-boxplot-second-item">'+n+'</span><br><span class="tooltip-boxplot-first-item">Q<sub>2</sub>:</span><span class="font-tabular-numbers tooltip-boxplot-second-item">'+o+'</span><br><span class="tooltip-boxplot-first-item">Q<sub>1</sub>:</span><span class="font-tabular-numbers tooltip-boxplot-second-item">'+l+'</span><br><span class="tooltip-boxplot-first-item">min:</span><span class="font-tabular-numbers tooltip-boxplot-second-item">'+r+"</span></div>")},v=(t,e)=>h.style("opacity",.8).html(`<b>${e.name}</b><br>outlier: ${s.format(e.value)}`),B=()=>{const t=b.attr("viewBox",[0,0,u,c]).append("g").attr("transform",`translate(${a.left}, ${a.top})`),e=d3.axisBottom(y),n=d3.axisLeft(g).tickFormat((t=>s.format(t))).ticks(10),o=d3.axisLeft(g).tickSize(a.left+a.right-u).tickFormat("").ticks(10).tickSizeOuter(0);t.append("g").attr("class","y axis-grid").attr("transform",`translate(${a.left}, 0)`).call(o),t.append("g").attr("class","x axis").attr("transform",`translate(0, ${c-a.bottom})`).call(e),t.append("g").attr("class","y axis").attr("transform",`translate(${a.left}, 0)`).call(n).append("text").attr("y",15).attr("transform","rotate(-90) translate(-20, 0.2)").attr("fill","#000").text("winnings/losses (CAD)"),t.selectAll("vertlines").data(m).enter().append("path").attr("d",(t=>`\n      M${y(t.name)}, ${g(t.range[1])}\n      V${g(t.quartiles[2])}\n      `)).attr("stroke","black").on("mouseover",w).on("mousemove",f).on("mouseout",x),t.selectAll("vertlines").data(m).enter().append("path").attr("d",(t=>`\n      M${y(t.name)}, ${g(t.quartiles[0])}\n      V${g(t.range[0])}\n      `)).attr("stroke","black").on("mouseover",w).on("mousemove",f).on("mouseout",x),t.selectAll("boxes").data(m).enter().append("path").attr("fill",(t=>t.colourHex)).attr("d",(t=>`\n        M${y(t.name)+p}, ${g(t.quartiles[2])}\n        H${y(t.name)-p}\n        V${g(t.quartiles[0])}\n        H${y(t.name)+p}\n        Z\n      `)).style("opacity",.8).on("mouseover",w).on("mousemove",f).on("mouseout",x),t.selectAll("horizlines").data(m).enter().append("path").attr("stroke","black").attr("d",(t=>`\n        M${y(t.name)+p},${g(t.quartiles[1])}\n        H${y(t.name)-p}\n      `)).on("mouseover",w).on("mousemove",f).on("mouseout",x),t.selectAll("horizlines").data(m).enter().append("path").attr("stroke","black").attr("d",(t=>`\n        M${y(t.name)+p/3},${g(t.range[1])}\n        H${y(t.name)-p/3}\n      `)).on("mouseover",w).on("mousemove",f).on("mouseout",x),t.selectAll("horizlines").data(m).enter().append("path").attr("stroke","black").attr("d",(t=>`\n        M${y(t.name)+p/3},${g(t.range[0])}\n        H${y(t.name)-p/3}\n      `)).on("mouseover",w).on("mousemove",f).on("mouseout",x),t.selectAll("circle-group").data(m).enter().append("g").attr("fill",(t=>t.colourHex)).attr("fill-opacity",.5).attr("stroke","none").attr("transform",(t=>`translate(${y(t.name)}, 0)`)).selectAll("circle").data((t=>t.outliers)).enter().append("g").attr("class","circle").append("circle").attr("r","0.22em").attr("cx",(()=>0*(Math.random()-.5))).attr("cy",(t=>g(t.value))).on("mouseover",v).on("mousemove",f).on("mouseout",x)};return B(),()=>{const t=o(),e=l(t);t===u&&e===c||(u=t,c=e,p=r(u),y.range([a.left,u-a.right]),g.range([c-a.bottom,a.top]),b.selectAll("*").remove(),B())}},parseCurrency=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),parseCurrencyPlusMinus=t=>(t>=0?"+":"")+parseCurrency.format(t),getTableHTML=t=>`<table class="table" style="table-layout:fixed;"><thead><tr><th>player</th><th class="text-end">net</th><th class="text-end">buy-in</th><th class="text-end">buy-out</th></tr></thead><tbody>${t}</tbody></table>`,getTbodyHTML=(t,e)=>{let a="";for(const o of e){const e=t.players.filter((t=>t.name===o.player))[0].colourRgb.map((t=>t+.8*(255-t)));a+=`<tr style="background:rgb(${e});border-color:rgb(${e});">`,a+=`<td style="font-weight:bold">${o.player}</td>`;const l=[(n=o.delta,(n>=0?"+":"")+parseCurrency.format(n)),parseCurrency.format(o.buyin),parseCurrency.format(o.buyout)];for(const t of l)a+=`<td class="font-tabular-numbers text-end">${t}</td>`;a+="</tr>"}var n;return a},changeSelectedGame=(t,e)=>{const a=document.getElementById("selected-game-title"),n=document.getElementById("selected-game-table-date-h4"),o=document.getElementById("selected-game-table-div"),l=e.map((e=>t.games.find((t=>t.id===e)))),r=new Date(l[0].date.replace(/-/g,"/"));n.textContent=r.toLocaleDateString("en-US",{timeZone:"UTC",weekday:"long",year:"numeric",month:"long",day:"numeric"}),a.textContent=l.length>1?"Selected games":"Selected game";let s="";for(const e of l)s+=`<table class="table" style="table-layout:fixed;"><thead><tr><th>player</th><th class="text-end">net</th><th class="text-end">buy-in</th><th class="text-end">buy-out</th></tr></thead><tbody>${getTbodyHTML(t,e.data)}</tbody></table>`;o.innerHTML=s},drawCalendar=(t,e)=>{const a=17,n=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),o=d3.utcParse("%Y-%m-%d"),l=t.games.map((t=>({date:o(t.date),totalBuyins:t.data.reduce(((t,e)=>t+e.buyin),0),deltasAad:t.data.reduce(((t,e)=>t+Math.abs(e.delta)),0)/t.data.length,deltasGmd:t.data.reduce(((e,a)=>e+t.data.reduce(((t,e)=>t+Math.abs(a.delta-e.delta)),0)),0)/Math.pow(t.data.length,2),id:t.id}))),r={},s=new Set,i=[];for(let t=0;t<l.length;t++){if(s.has(t))continue;const e=l[t].date,a=l.map(((t,a)=>t.date.getTime()===e.getTime()?a:"")).filter(String),n=a.map((t=>l[t].id));if(r[n[0]]=n.slice().reverse(),1!==a.length){for(let e=1;e<a.length;e++)l[t].totalBuyins+=l[e].totalBuyins,i.push(a[e]),s.add(a[e]);l[t].date=l[a[a.length-1]].date}}for(const t of i.reverse())l.splice(t,1);const d=d3.utcDays(new Date(Date.UTC(l[l.length-1].date.getFullYear(),0,1)),l[l.length-1].date),m=d3.utcDays(l[0].date,new Date(Date.UTC(l[0].date.getFullYear()+1,0,1)));m.shift();const u=[...d,...m];l.reduce(((t,e)=>{const a=d3.utcDays(e.date,t.date);return a.shift(),u.push(...a),e}));for(const t of u)l.push({date:t,totalBuyins:0,id:null});l.sort(((t,e)=>e.date-t.date));const c=d3.map(l,(t=>t.date)),p=d3.map(l,(t=>t.totalBuyins)),y=d3.range(c.length),g=d3.groups(y,(t=>c[t].getUTCFullYear())),b=d3.utcFormat("%b"),h=d3.scaleSqrt().domain([0,d3.max(l.map((t=>t.totalBuyins)))]).range(["#ebedf0","teal"]),f=d3.select("#"+e).append("svg").attr("id","calendar-svg"),x=d3.select("#"+e).append("div").style("opacity",0).style("position","absolute").attr("class","tooltip"),w=153*g.length;f.attr("width",950).attr("height",w).attr("viewBox",[0,0,950,w]).attr("font-family","sans-serif").attr("font-size",10);const v=f.selectAll("g").data(g).join("g").attr("transform",((t,e)=>`translate(40.5,${153*e+25.5})`));v.append("text").attr("x",-5).attr("y",-5).attr("font-weight","bold").attr("text-anchor","end").text((([t])=>t)),v.append("g").attr("text-anchor","end").selectAll("text").data(d3.range(7)).join("text").attr("x",-5).attr("y",(t=>(t+.5)*a)).attr("dy","0.31em").text((t=>"SMTWRFS"[t])),v.append("g").selectAll("rect").data((([,t])=>t)).join("rect").attr("width",16).attr("height",16).attr("x",(t=>d3.utcSunday.count(d3.utcYear(c[t]),c[t])*a+.5)).attr("y",(t=>c[t].getUTCDay()*a+.5)).attr("fill",(t=>h(p[t]))).on("mouseover",((t,e)=>x.style("opacity",.8).html(`<b>${c[e].toLocaleDateString("en-US",{timeZone:"UTC",weekday:"long",year:"numeric",month:"long",day:"numeric"})}</b><br>`+(null===l[e].id?"no game":`total buy-ins: ${n.format(l[e].totalBuyins)}<br>deltas AAD: ${n.format(l[e].deltasAad)}<br>deltas GMD: ${n.format(l[e].deltasGmd)}`)))).on("mousemove",(t=>x.style("left",t.pageX+30+"px").style("top",t.pageY-20+"px"))).on("mouseout",(()=>x.style("opacity",0))).on("click",((e,a)=>{null!==l[a].id&&changeSelectedGame(t,r[l[a].id]),document.getElementById("selected-game-title").scrollIntoView()}));const B=v.append("g").selectAll("g").data((([,t])=>d3.utcMonths(c[t[t.length-1]],c[t[0]]))).join("g");B.filter(((t,e)=>e)).append("path").attr("fill","none").attr("stroke","#fff").attr("stroke-width",3).attr("d",(t=>{const e=Math.min(7,t.getUTCDay()),n=d3.utcSunday.count(d3.utcYear(t),t);return(7===e?`M${(n+1)*a},0`:`M${(n+1)*a},0V${e*a}H${n*a}`)+"V119"})),B.append("text").attr("x",(t=>d3.utcSunday.count(d3.utcYear(t),d3.utcSunday.ceil(t))*a+2)).attr("y",-5).text(b)},data={players:[{name:"David",colourHex:"#70ad4b",colourRgb:[112,173,75],avatar:"https://mwiens91.github.io/poker-plots/data/avatars/david.webp",gameCount:1,cumSum:33.76,matchupData:[{player:"David",players:["David","Aidan","Bei","Bobby","Juno"],gameCount:1,cumSum:33.76}],stats:{"total-money-won":33.76,"total-money-lost":0,"largest-winning-streak":{"num-games":1,total:33.76,"start-game-id":1,"end-game-id":1},"largest-losing-streak":null,"most-won-in-single-game":{total:33.76,"game-id":1},"most-lost-in-single-game":null},data:[{id:1,date:"2022-06-01",player:"David",buyin:40,buyout:73.76,delta:33.76,cumSum:33.76}]},{name:"Bobby",colourHex:"#8772c8",colourRgb:[135,114,200],avatar:"https://mwiens91.github.io/poker-plots/data/avatars/bobby.webp",gameCount:7,cumSum:33.15,matchupData:[{player:"Bobby",players:["Bobby","Aidan","Juno"],gameCount:2,cumSum:19.72},{player:"Bobby",players:["Bobby","Aidan","Bei","Juno"],gameCount:2,cumSum:-.86},{player:"Bobby",players:["Bobby","Aidan","Juno","Shawn"],gameCount:1,cumSum:34.88},{player:"Bobby",players:["Bobby","Aidan","Bei","David","Juno"],gameCount:1,cumSum:-19.1},{player:"Bobby",players:["Bobby","Juno","Matt"],gameCount:1,cumSum:-1.49}],stats:{"total-money-won":54.79,"total-money-lost":21.64,"largest-winning-streak":{"num-games":4,total:54.79,"start-game-id":3,"end-game-id":6},"largest-losing-streak":{"num-games":2,total:-20.15,"start-game-id":1,"end-game-id":2},"most-won-in-single-game":{total:34.88,"game-id":5},"most-lost-in-single-game":{total:-19.1,"game-id":1}},data:[{id:1,date:"2022-06-01",player:"Bobby",buyin:35.75,buyout:16.65,delta:-19.1,cumSum:-19.1},{id:2,date:"2022-06-02",player:"Bobby",buyin:20,buyout:18.95,delta:-1.05,cumSum:-20.15},{id:3,date:"2022-06-19",player:"Bobby",buyin:10,buyout:18.23,delta:8.23,cumSum:-11.92},{id:4,date:"2022-06-20",player:"Bobby",buyin:10,buyout:10.19,delta:.19,cumSum:-11.73},{id:5,date:"2022-07-18",player:"Bobby",buyin:20,buyout:54.88,delta:34.88,cumSum:23.15},{id:6,date:"2022-08-01",player:"Bobby",buyin:35,buyout:46.49,delta:11.49,cumSum:34.64},{id:7,date:"2022-08-31",player:"Bobby",buyin:10,buyout:8.51,delta:-1.49,cumSum:33.15}]},{name:"Bei",colourHex:"#c75a8f",colourRgb:[199,90,143],avatar:"https://mwiens91.github.io/poker-plots/data/avatars/bei.webp",gameCount:3,cumSum:12.47,matchupData:[{player:"Bei",players:["Bei","Aidan","Bobby","Juno"],gameCount:2,cumSum:-17.65},{player:"Bei",players:["Bei","Aidan","Bobby","David","Juno"],gameCount:1,cumSum:30.12}],stats:{"total-money-won":30.12,"total-money-lost":17.65,"largest-winning-streak":{"num-games":1,total:30.12,"start-game-id":1,"end-game-id":1},"largest-losing-streak":{"num-games":2,total:-17.65,"start-game-id":2,"end-game-id":4},"most-won-in-single-game":{total:30.12,"game-id":1},"most-lost-in-single-game":{total:-10,"game-id":4}},data:[{id:1,date:"2022-06-01",player:"Bei",buyin:20,buyout:50.12,delta:30.12,cumSum:30.12},{id:2,date:"2022-06-02",player:"Bei",buyin:40,buyout:32.35,delta:-7.65,cumSum:22.47},{id:4,date:"2022-06-20",player:"Bei",buyin:13.5,buyout:3.5,delta:-10,cumSum:12.47}]},{name:"Shawn",colourHex:"#d2a649",colourRgb:[210,166,73],avatar:"https://mwiens91.github.io/poker-plots/data/avatars/shawn.webp",gameCount:1,cumSum:5.12,matchupData:[{player:"Shawn",players:["Shawn","Aidan","Bobby","Juno"],gameCount:1,cumSum:5.12}],stats:{"total-money-won":5.12,"total-money-lost":0,"largest-winning-streak":{"num-games":1,total:5.12,"start-game-id":5,"end-game-id":5},"largest-losing-streak":null,"most-won-in-single-game":{total:5.12,"game-id":5},"most-lost-in-single-game":null},data:[{id:5,date:"2022-07-18",player:"Shawn",buyin:15.74,buyout:20.86,delta:5.12,cumSum:5.12}]},{name:"Matt",colourHex:"#50b09a",colourRgb:[80,176,154],avatar:"https://mwiens91.github.io/poker-plots/data/avatars/matt.webp",gameCount:1,cumSum:-.63,matchupData:[{player:"Matt",players:["Matt","Bobby","Juno"],gameCount:1,cumSum:-.63}],stats:{"total-money-won":0,"total-money-lost":.63,"largest-winning-streak":null,"largest-losing-streak":{"num-games":1,total:-.63,"start-game-id":7,"end-game-id":7},"most-won-in-single-game":null,"most-lost-in-single-game":{total:-.63,"game-id":7}},data:[{id:7,date:"2022-08-31",player:"Matt",buyin:5,buyout:4.37,delta:-.63,cumSum:-.63}]},{name:"Aidan",colourHex:"#cd5943",colourRgb:[205,89,67],avatar:"https://mwiens91.github.io/poker-plots/data/avatars/aidan.webp",gameCount:6,cumSum:-7.86,matchupData:[{player:"Aidan",players:["Aidan","Bei","Bobby","Juno"],gameCount:2,cumSum:48.79},{player:"Aidan",players:["Aidan","Bobby","Juno"],gameCount:2,cumSum:-20.36},{player:"Aidan",players:["Aidan","Bei","Bobby","David","Juno"],gameCount:1,cumSum:-26.29},{player:"Aidan",players:["Aidan","Bobby","Juno","Shawn"],gameCount:1,cumSum:-10}],stats:{"total-money-won":52.05,"total-money-lost":59.91,"largest-winning-streak":{"num-games":1,total:52.05,"start-game-id":2,"end-game-id":2},"largest-losing-streak":{"num-games":4,total:-33.62,"start-game-id":3,"end-game-id":6},"most-won-in-single-game":{total:52.05,"game-id":2},"most-lost-in-single-game":{total:-26.29,"game-id":1}},data:[{id:1,date:"2022-06-01",player:"Aidan",buyin:40,buyout:13.71,delta:-26.29,cumSum:-26.29},{id:2,date:"2022-06-02",player:"Aidan",buyin:10,buyout:62.05,delta:52.05,cumSum:25.76},{id:3,date:"2022-06-19",player:"Aidan",buyin:12.5,buyout:7.14,delta:-5.36,cumSum:20.4},{id:4,date:"2022-06-20",player:"Aidan",buyin:12,buyout:8.74,delta:-3.26,cumSum:17.14},{id:5,date:"2022-07-18",player:"Aidan",buyin:10,buyout:0,delta:-10,cumSum:7.14},{id:6,date:"2022-08-01",player:"Aidan",buyin:15,buyout:0,delta:-15,cumSum:-7.86}]},{name:"Juno",colourHex:"#887234",colourRgb:[136,114,52],avatar:"https://mwiens91.github.io/poker-plots/data/avatars/juno.webp",gameCount:7,cumSum:-76.01,matchupData:[{player:"Juno",players:["Juno","Aidan","Bei","Bobby"],gameCount:2,cumSum:-30.28},{player:"Juno",players:["Juno","Aidan","Bobby"],gameCount:2,cumSum:.64},{player:"Juno",players:["Juno","Aidan","Bobby","Shawn"],gameCount:1,cumSum:-30},{player:"Juno",players:["Juno","Aidan","Bei","Bobby","David"],gameCount:1,cumSum:-18.49},{player:"Juno",players:["Juno","Bobby","Matt"],gameCount:1,cumSum:2.12}],stats:{"total-money-won":18.7,"total-money-lost":94.71,"largest-winning-streak":{"num-games":1,total:13.07,"start-game-id":4,"end-game-id":4},"largest-losing-streak":{"num-games":3,total:-64.71,"start-game-id":1,"end-game-id":3},"most-won-in-single-game":{total:13.07,"game-id":4},"most-lost-in-single-game":{total:-43.35,"game-id":2}},data:[{id:1,date:"2022-06-01",player:"Juno",buyin:80,buyout:61.51,delta:-18.49,cumSum:-18.49},{id:2,date:"2022-06-02",player:"Juno",buyin:80,buyout:36.65,delta:-43.35,cumSum:-61.84},{id:3,date:"2022-06-19",player:"Juno",buyin:30,buyout:27.13,delta:-2.87,cumSum:-64.71},{id:4,date:"2022-06-20",player:"Juno",buyin:10,buyout:23.07,delta:13.07,cumSum:-51.64},{id:5,date:"2022-07-18",player:"Juno",buyin:30,buyout:0,delta:-30,cumSum:-81.64},{id:6,date:"2022-08-01",player:"Juno",buyin:20,buyout:23.51,delta:3.51,cumSum:-78.13},{id:7,date:"2022-08-31",player:"Juno",buyin:19.99,buyout:22.11,delta:2.12,cumSum:-76.01}]}],games:[{id:7,date:"2022-08-31",data:[{player:"Juno",buyin:19.99,buyout:22.11,delta:2.12},{player:"Matt",buyin:5,buyout:4.37,delta:-.63},{player:"Bobby",buyin:10,buyout:8.51,delta:-1.49}]},{id:6,date:"2022-08-01",data:[{player:"Bobby",buyin:35,buyout:46.49,delta:11.49},{player:"Juno",buyin:20,buyout:23.51,delta:3.51},{player:"Aidan",buyin:15,buyout:0,delta:-15}]},{id:5,date:"2022-07-18",data:[{player:"Bobby",buyin:20,buyout:54.88,delta:34.88},{player:"Shawn",buyin:15.74,buyout:20.86,delta:5.12},{player:"Aidan",buyin:10,buyout:0,delta:-10},{player:"Juno",buyin:30,buyout:0,delta:-30}]},{id:4,date:"2022-06-20",data:[{player:"Juno",buyin:10,buyout:23.07,delta:13.07},{player:"Bobby",buyin:10,buyout:10.19,delta:.19},{player:"Aidan",buyin:12,buyout:8.74,delta:-3.26},{player:"Bei",buyin:13.5,buyout:3.5,delta:-10}]},{id:3,date:"2022-06-19",data:[{player:"Bobby",buyin:10,buyout:18.23,delta:8.23},{player:"Juno",buyin:30,buyout:27.13,delta:-2.87},{player:"Aidan",buyin:12.5,buyout:7.14,delta:-5.36}]},{id:2,date:"2022-06-02",data:[{player:"Aidan",buyin:10,buyout:62.05,delta:52.05},{player:"Bobby",buyin:20,buyout:18.95,delta:-1.05},{player:"Bei",buyin:40,buyout:32.35,delta:-7.65},{player:"Juno",buyin:80,buyout:36.65,delta:-43.35}]},{id:1,date:"2022-06-01",data:[{player:"David",buyin:40,buyout:73.76,delta:33.76},{player:"Bei",buyin:20,buyout:50.12,delta:30.12},{player:"Juno",buyin:80,buyout:61.51,delta:-18.49},{player:"Bobby",buyin:35.75,buyout:16.65,delta:-19.1},{player:"Aidan",buyin:40,buyout:13.71,delta:-26.29}]}]},drawLinePlot=(t,e,a)=>{const n="0.14rem",o="0.23em",l=document.getElementById("main-container"),r=()=>l.clientWidth,s=t=>Math.max(Math.min(100*Math.floor(document.documentElement.clientHeight/100)-220,.65*t),.45*t);let i=!0;const d=t=>i?t.date:t.id,m=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),u=d3.utcParse("%Y-%m-%d"),c=t.players.map((t=>({...t,data:t.data.map((t=>({...t,date:u(t.date)})))}))),p=new Set;for(let e=0;e<t.games.length-1;e++){if(p.has(t.games[e].id))continue;const a=t.games.filter((a=>a.date===t.games[e].date)).map((t=>t.id));if(1!==a.length){a.reverse();for(let t=1;t<a.length;t++){const e=24*t/(a.length+1);c.forEach((n=>n.data.find((e=>e.id===a[t]))?.date.setHours(n.data[t].date.getHours()+e)))}a.forEach((t=>p.add(t)))}}const y=c.map((t=>t.data.map((t=>t.date)))).flat(),g=d3.extent(c.map((t=>t.data.map((t=>t.cumSum)))).flat()).map((t=>1.05*t)),b=[];for(const t of c){if(1===t.data.length)continue;const e=[...t.data];let a=t,n=0;for(let t=1;t<e.length;t++)e[t].id-e[t-1].id>9&&(a.data=e.slice(n,t),a={...a},a.data=e.slice(t),b.push(a),n=t)}c.push(...b);let h=r(),f=s(h);const x=d3.min(y),w=d3.max(y),v=d3.max(t.games.map((t=>t.id))),B=Math.max(1,(w.getTime()-x.getTime())/12096e5),S=Math.max(1,(v-1)/10),C=(1-.9)/(v-.9),k=(w.getTime()-x.getTime())*C/(1-C),A=new Date(Number(x));A.setTime(x.getTime()-k);let E=(i?d3.scaleUtc:d3.scaleLinear)().domain(i?[A,w]:[.9,v]).range([a.left,h-a.right-50]),M=E.copy();const $=new Proxy(new URLSearchParams(window.location.search),{get:(t,e)=>t.get(e)}).lineYScaleExponent,I=d3.scalePow().exponent(null===$?1:parseFloat($)).domain(g).range([f-a.bottom,a.top]),P=d3.select("#"+e).append("svg"),D=d3.select("#line-plot-avatar-div"),H=d3.select("#line-plot-player-div"),J=d3.select("#line-plot-game-div"),T=d3.select("#line-plot-avatar"),U=d3.select("#line-plot-player"),L=d3.select("#line-plot-amount"),F=d3.select("#line-plot-game-title"),W=d3.select("#line-plot-game-info"),R=(t,e)=>{P.selectAll(".line").style("opacity",.15),P.selectAll(".circle").style("opacity",.15),P.selectAll(".line").filter((e=>e.name===t)).style("opacity",.7).style("stroke-width","0.18rem").style("cursor",(()=>e?"pointer":"none")),P.selectAll(".circle").filter((e=>e.player===t)).style("opacity",.85)},z=()=>{P.selectAll(".line").style("opacity",.6).style("stroke-width",n).style("cursor","none"),P.selectAll(".circle").style("opacity",.85)},q=t=>{D.style("background","rgb("+t.colourRgb.map((t=>t+.17*(255-t)))+")"),H.style("background","rgb("+t.colourRgb.map((t=>t+.4*(255-t)))+")"),T.attr("src",t.avatar),U.text(t.name),L.text(m.format(t.cumSum))};for(const t of c){const e=document.getElementById("legend-icon-div-"+t.name);e.addEventListener("mouseover",(()=>{R(t.name,!1),q(t)})),e.addEventListener("mouseout",z)}let Y,N,G,V;P.attr("preserveAspectRatio","xMinYMin meet").attr("viewBox",[0,0,h,f]);const j=d3.zoom().scaleExtent(i?[.7,B]:[.7,S]).on("zoom",(({transform:t})=>{E=t.rescaleX(M),Y.scale(E),N.call(Y),G.selectAll("circle").attr("cx",(t=>E(d(t)))),G.selectAll("path").attr("d",(t=>V(t.data)))}));P.call(j).on("wheel",(t=>t.preventDefault())).on("dblclick.zoom",null).on("dblclick",(()=>{i=!i,E=(i?d3.scaleUtc:d3.scaleLinear)().domain(i?[A,w]:[.9,v]).range([a.left,h-a.right-50]),M=E.copy(),i?j.scaleExtent([.7,B]):j.scaleExtent([.7,S]),Y.scale(E),N.transition().call(Y),G.selectAll("circle").transition().attr("cx",(t=>E(d(t)))),G.selectAll("path").transition().attr("d",(t=>V(t.data))).on("end",(()=>P.call(j.transform,d3.zoomIdentity)))}));const O=()=>{const e=P.append("g").attr("transform",`translate(${a.left}, ${a.top})`);Y=d3.axisBottom(E);const l=d3.axisLeft(I).tickFormat((t=>m.format(t))).ticks(13),r=d3.axisLeft(I).tickSize(a.left+a.right-h).tickFormat("").ticks(13).tickSizeOuter(0);e.append("g").attr("class","y axis-grid").attr("transform",`translate(${a.left}, 0)`).call(r),N=e.append("g").attr("class","x axis").attr("transform",`translate(0, ${f-a.bottom})`).call(Y),e.append("g").attr("class","y axis").attr("transform",`translate(${a.left}, 0)`).call(l).append("text").attr("y",15).attr("transform","rotate(-90) translate(-10, 0.2)").attr("fill","#000").text("cumulative sum (CAD)"),e.append("defs").append("svg:clipPath").attr("id","clip").append("svg:rect").attr("width",h-a.left-a.right).attr("height",f-a.top-a.bottom).attr("x",a.left).attr("y",a.top),G=e.append("g").attr("clip-path","url(#clip)"),V=d3.line().x((t=>E(d(t)))).y((t=>I(t.cumSum)));const s=G.append("g").attr("class","lines");s.selectAll(".line-group").data(c).enter().append("g").attr("class","line-group").append("path").attr("class","line").attr("d",(t=>V(t.data))).style("stroke",(t=>t.colourHex)).style("stroke-width",n).style("opacity",.6).on("mouseover",((t,e)=>{R(e.name,!0),q(e)})).on("mouseout",z),s.selectAll("circle-group").data(c).enter().append("g").style("fill",(t=>t.colourHex)).selectAll("circle").data((t=>t.data)).enter().append("g").attr("class","circle").append("circle").attr("cx",(t=>E(d(t)))).attr("cy",(t=>I(t.cumSum))).attr("r",o).style("opacity",.85).on("mouseover",((t,e)=>{d3.select(t.currentTarget).transition().attr("r","0.46em").style("cursor","pointer");const a=c.find((t=>t.name===e.player));q(a),J.style("background","rgb("+a.colourRgb.map((t=>t+.8*(255-t)))+")"),F.text(e.date.toLocaleDateString("en-US",{timeZone:"UTC",weekday:"long",year:"numeric",month:"long",day:"numeric"})),W.html("Σ="+m.format(e.cumSum)+"&nbsp;&nbsp; Δ="+m.format(e.delta)+"&nbsp;&nbsp; ↧"+m.format(e.buyin)+"&nbsp;&nbsp; ↥"+m.format(e.buyout))})).on("mouseout",(t=>{d3.select(t.currentTarget).transition().attr("r",o).style("cursor","none"),J.style("background","#FFFFFF"),F.text(""),W.text("")})).on("click",((e,a)=>{changeSelectedGame(t,[a.id]),document.getElementById("selected-game-div").scrollIntoView()}))};return O(),()=>{const t=r(),e=s(t);if(t!==h||e!==f){const n=(t-a.left-a.right)/(h-a.left-a.right);h=t,f=e;const o=d3.zoomTransform(P.node());P.call(j.transform,d3.zoomIdentity),P.attr("viewBox",[0,0,h,f]),E.range([a.left,h-a.right-50]),M=E.copy(),I.range([f-a.bottom,a.top]),P.selectAll("*").remove(),O(),o.x*=n,o.y*=n,P.call(j.transform,o)}}},initializePeopleSection=t=>{const e=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),a=document.getElementById("people-body-avatar"),n=document.getElementById("people-body-player-title-name"),o=document.getElementById("people-body-player-title-divider"),l=document.getElementById("people-body-player-title-cumsum"),r=document.getElementById("people-body-hr"),s=document.getElementById("people-body-games-played"),i=document.getElementById("people-body-total-money-won"),d=document.getElementById("people-body-total-money-lost"),m=document.getElementById("people-body-most-money-won-consecutive-main"),u=document.getElementById("people-body-most-money-won-consecutive-sub"),c=document.getElementById("people-body-most-money-lost-consecutive-main"),p=document.getElementById("people-body-most-money-lost-consecutive-sub"),y=document.getElementById("people-body-most-money-won-single-main"),g=document.getElementById("people-body-most-money-won-single-sub"),b=document.getElementById("people-body-most-money-lost-single-main"),h=document.getElementById("people-body-most-money-lost-single-sub"),f=document.getElementById("people-matchups-div"),x=x=>{a.setAttribute("src",x.avatar),n.textContent=x.name,o.style.color=x.colourHex,l.textContent=e.format(x.cumSum),r.style.backgroundColor=x.colourHex,s.textContent=x.gameCount,i.textContent=e.format(x.stats["total-money-won"]),d.textContent=e.format(x.stats["total-money-lost"]),null===x.stats["largest-winning-streak"]?(m.textContent="?",u.textContent=x.name+" has never won a game"):1===x.stats["largest-winning-streak"]["num-games"]?(m.textContent=e.format(x.stats["largest-winning-streak"].total),u.textContent="on "+t.games.find((t=>t.id===x.stats["largest-winning-streak"]["start-game-id"])).date+" (1 game)"):(m.textContent=e.format(x.stats["largest-winning-streak"].total),u.textContent="on "+t.games.find((t=>t.id===x.stats["largest-winning-streak"]["start-game-id"])).date+" through "+t.games.find((t=>t.id===x.stats["largest-winning-streak"]["end-game-id"])).date+" ("+x.stats["largest-winning-streak"]["num-games"]+" games)"),null===x.stats["largest-losing-streak"]?(c.textContent="?",p.textContent=x.name+" has never lost a game"):1===x.stats["largest-losing-streak"]["num-games"]?(c.textContent=e.format(-x.stats["largest-losing-streak"].total),p.textContent="on "+t.games.find((t=>t.id===x.stats["largest-losing-streak"]["start-game-id"])).date+" (1 game)"):(c.textContent=e.format(-x.stats["largest-losing-streak"].total),p.textContent="on "+t.games.find((t=>t.id===x.stats["largest-losing-streak"]["start-game-id"])).date+" through "+t.games.find((t=>t.id===x.stats["largest-losing-streak"]["end-game-id"])).date+" ("+x.stats["largest-losing-streak"]["num-games"]+" games)"),null===x.stats["most-won-in-single-game"]?(y.textContent="?",g.textContent=x.name+" has never won a game"):(y.textContent=e.format(x.stats["most-won-in-single-game"].total),g.textContent="on "+t.games.find((t=>t.id===x.stats["most-won-in-single-game"]["game-id"])).date),null===x.stats["most-lost-in-single-game"]?(b.textContent="?",h.textContent=x.name+" has never lost a game"):(b.textContent=e.format(-x.stats["most-lost-in-single-game"].total),h.textContent="on "+t.games.find((t=>t.id===x.stats["most-lost-in-single-game"]["game-id"])).date),f.innerHTML="";for(const[t,a]of x.matchupData.entries()){if(t>5)break;const n=document.createElement("div");n.classList.add("people-matchup-div"),n.style.background="rgb("+x.colourRgb.map((t=>t+.7*(255-t)))+")",n.innerHTML=`<div style="padding-bottom: 6px"><b>${a.players.join(", ")}</b><br><em>${a.gameCount} game${a.gameCount>1?"s":""}, ${a.players.length} players</em></div><span style="font-size: 16px"<>${e.format(a.cumSum)}</span>`,f.appendChild(n)}};for(const e of t.players){document.getElementById("people-icon-div-"+e.name).addEventListener("mouseover",(()=>x(e)))}let w=t.players.filter((t=>t.gameCount>=3));0===w.length&&(w=t.players);const v=w[Math.floor(Math.random()*w.length)];return x(v),v.name},drawPiePlot=(t,e,a)=>{const n=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),o=d3.select("#"+e).append("svg"),l=d3.pie().value((t=>Math.abs(t.cumSum)))(t),r=t.reduce(((t,e)=>t+e.cumSum),0),s=d3.select("#"+e).append("div").style("opacity",0).style("position","absolute").attr("class","tooltip"),i=t=>s.style("left",t.pageX+30+"px").style("top",t.pageY-20+"px"),d=()=>s.style("opacity",0),m=(t,e)=>s.style("opacity",.8).html(`<b>${e.data.name}</b><br>cumulative sum: ${n.format(e.data.cumSum)}<br>percent total ${e.data.cumSum>0?"winnings":"losses"}: ${Math.round(e.data.cumSum/r*100*10)/10}%`),u=document.getElementById(e),c=()=>u.clientWidth;let p=c();const y=()=>{const t=Math.min(p/2-a.left,p/2-a.right,p/2-a.top,p/2-a.bottom),e=2*t,n=o.attr("viewBox",[0,0,p,e]).append("g").attr("transform",`translate(${p/2}, ${e/2})`),r=d3.arc().innerRadius(.5*t).outerRadius(.8*t),s=d3.arc().innerRadius(.9*t).outerRadius(.9*t);n.selectAll("g.slice").data(l).enter().append("g").append("path").attr("d",r).attr("fill",(t=>t.data.colourHex)).attr("stroke","white").style("stroke-width","2px").style("opacity",.7).on("mouseover",m).on("mousemove",i).on("mouseout",d);const u=t=>t.startAngle+(t.endAngle-t.startAngle)/2,c=n.selectAll("g.slice").data(l.filter((t=>t.endAngle-t.startAngle>.22))).enter().append("g");c.append("polyline").attr("stroke","black").style("fill","none").attr("stroke-width",1).attr("points",(function(e){const a=r.centroid(e),n=s.centroid(e),o=s.centroid(e);return o[0]=.95*t*(u(e)<Math.PI?1:-1),[a,n,o]})).on("mouseover",m).on("mousemove",i).on("mouseout",d),c.append("text").attr("transform",(e=>{const a=s.centroid(e);return a[0]=.99*t*(u(e)<Math.PI?1:-1),"translate("+a+")"})).style("text-anchor",(t=>u(t)<Math.PI?"start":"end")).text((t=>t.data.name)).on("mouseover",m).on("mousemove",i).on("mouseout",d)};return y(),()=>{const t=c();t!==p&&(p=t,o.selectAll("*").remove(),y())}};initializePeopleSection(data);const linePlotMargin={top:10,bottom:40,left:35,right:35},boxPlotMargin={top:20,bottom:42,left:35,right:35},piePlotMargin={top:0,bottom:0,left:47,right:47},redrawLinePlot=drawLinePlot(data,"line-plot-parent",linePlotMargin),redrawBoxPlot=drawBoxPlot(data.players,"box-plot-parent",boxPlotMargin),redrawWinnerPiePlot=drawPiePlot(data.players.filter((t=>t.cumSum>0)),"winner-pie-chart-parent",piePlotMargin),redrawLoserPiePlot=drawPiePlot(data.players.filter((t=>t.cumSum<0)),"loser-pie-chart-parent",piePlotMargin);drawCalendar(data,"calendar-parent");const MIN_ACCEPTABLE_WIDTH=992,containerElement=document.getElementById("main-container"),calendarElement=document.getElementById("calendar"),alertBoxElement=document.getElementById("alert-box"),pageUpCircleElement=document.getElementById("page-up-circle"),pageUpCircleNormalTopMargin=parseInt(getComputedStyle(pageUpCircleElement).marginTop.slice(0,-2)),narrowViewportHandle=t=>{t<992?(calendarElement.style.display="none",alertBoxElement.style.display="block",pageUpCircleElement.style.marginTop=pageUpCircleNormalTopMargin+Math.round(alertBoxElement.offsetHeight)+"px"):(calendarElement.style.display="block",alertBoxElement.style.display="none",pageUpCircleElement.style.marginTop=pageUpCircleNormalTopMargin+"px")};narrowViewportHandle(document.documentElement.clientWidth);let prevContainerWidth=containerElement.clientWidth,prevWindowWidth=document.documentElement.clientWidth,prevWindowHeightFloored=100*Math.floor(document.documentElement.clientHeight/100);const windowResizeListener=()=>{const t=document.documentElement.clientHeight,e=document.documentElement.clientWidth,a=containerElement.clientWidth,n=100*Math.floor(t/100);(e-992)*(prevWindowWidth-992)<=0&&(prevWindowWidth=e,narrowViewportHandle(e));let o=!1,l=!1;a!==prevContainerWidth&&(prevContainerWidth=a,o=!0),n!==prevWindowHeightFloored&&(prevWindowHeightFloored=n,l=!0),o?(redrawLinePlot(),redrawBoxPlot(),redrawWinnerPiePlot(),redrawLoserPiePlot()):l&&(redrawLinePlot(),redrawBoxPlot())};window.addEventListener("resize",windowResizeListener);const circleElement=document.getElementById("page-up-circle"),observer=new IntersectionObserver((t=>{t[0].isIntersecting?circleElement.style.display="block":circleElement.style.display="none"}),{rootMargin:"0px 0px -100% 0px",threshold:[0]});observer.observe(document.getElementById("page-up-circle-trigger"));const expandGamesButtonElement=document.getElementById("expand-games-button"),collapseGamesElement=document.getElementById("collapse-games");expandGamesButtonElement.onclick=()=>{collapseGamesElement.offsetHeight>100&&collapseGamesElement.scrollIntoView()};
