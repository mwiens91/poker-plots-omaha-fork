const drawBoxPlot=(t,e,a)=>{const n=document.getElementById("main-container"),o=()=>n.clientWidth,l=t=>Math.max(Math.min(100*Math.floor(document.documentElement.clientHeight/100)-200,.65*t),.45*t),r=t=>22*t/1296,s=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),i=t=>(t>=0?"+":"")+s.format(t);let d=t.filter((t=>t.data.length>=5));0===d.length&&(d=t);const m=d.map((t=>{const e=t.data.map((t=>t.delta)),a=d3.quantile(e,.25),n=d3.quantile(e,.5),o=d3.quantile(e,.75),l=o-a,r=d3.max([d3.min(e),a-1.5*l]),s=d3.min([d3.max(e),o+1.5*l]);return{...t,quartiles:[a,n,o],range:[r,s],outliers:e.filter((t=>t<r||t>s)).map((e=>({value:e,name:t.name})))}}));let c=o(),u=l(c),p=r(c);const g=d3.scaleBand().domain(m.map((t=>t.name))).paddingInner(1).paddingOuter(.5).range([a.left,c-a.right]),y=d3.scaleLinear().domain(d3.extent(m.map((t=>[...t.outliers.map((t=>t.value)),...t.range])).flat()).map((t=>1.05*t))).range([u-a.bottom,a.top]),b=d3.select("#"+e).append("svg"),h=d3.select("#"+e).append("div").style("opacity",0).style("position","absolute").attr("class","tooltip"),f=t=>h.style("left",t.pageX+30+"px").style("top",t.pageY-20+"px"),x=()=>h.style("opacity",0),v=(t,e)=>{const a=i(e.range[1]),n=i(e.quartiles[2]),o=i(e.quartiles[1]),l=i(e.quartiles[0]),r=i(e.range[0]);h.style("opacity",.8).html(`<b>${e.name}</b> (N=${e.gameCount})<br><div style="line-height: 135%"><span class="tooltip-boxplot-first-item">max:</span><span class="font-tabular-numbers tooltip-boxplot-second-item">`+a+'</span><br><span class="tooltip-boxplot-first-item">Q<sub>3</sub>:</span><span class="font-tabular-numbers tooltip-boxplot-second-item">'+n+'</span><br><span class="tooltip-boxplot-first-item">Q<sub>2</sub>:</span><span class="font-tabular-numbers tooltip-boxplot-second-item">'+o+'</span><br><span class="tooltip-boxplot-first-item">Q<sub>1</sub>:</span><span class="font-tabular-numbers tooltip-boxplot-second-item">'+l+'</span><br><span class="tooltip-boxplot-first-item">min:</span><span class="font-tabular-numbers tooltip-boxplot-second-item">'+r+"</span></div>")},w=(t,e)=>h.style("opacity",.8).html(`<b>${e.name}</b><br>outlier: ${s.format(e.value)}`),S=()=>{const t=b.attr("viewBox",[0,0,c,u]).append("g").attr("transform",`translate(${a.left}, ${a.top})`),e=d3.axisBottom(g),n=d3.axisLeft(y).tickFormat((t=>s.format(t))).ticks(10),o=d3.axisLeft(y).tickSize(a.left+a.right-c).tickFormat("").ticks(10).tickSizeOuter(0);t.append("g").attr("class","y axis-grid").attr("transform",`translate(${a.left}, 0)`).call(o),t.append("g").attr("class","x axis").attr("transform",`translate(0, ${u-a.bottom})`).call(e),t.append("g").attr("class","y axis").attr("transform",`translate(${a.left}, 0)`).call(n).append("text").attr("y",15).attr("transform","rotate(-90) translate(-20, 0.2)").attr("fill","#000").text("winnings/losses (CAD)"),t.selectAll("vertlines").data(m).enter().append("path").attr("d",(t=>`\n      M${g(t.name)}, ${y(t.range[1])}\n      V${y(t.quartiles[2])}\n      `)).attr("stroke","black").on("mouseover",v).on("mousemove",f).on("mouseout",x),t.selectAll("vertlines").data(m).enter().append("path").attr("d",(t=>`\n      M${g(t.name)}, ${y(t.quartiles[0])}\n      V${y(t.range[0])}\n      `)).attr("stroke","black").on("mouseover",v).on("mousemove",f).on("mouseout",x),t.selectAll("boxes").data(m).enter().append("path").attr("fill",(t=>t.colourHex)).attr("d",(t=>`\n        M${g(t.name)+p}, ${y(t.quartiles[2])}\n        H${g(t.name)-p}\n        V${y(t.quartiles[0])}\n        H${g(t.name)+p}\n        Z\n      `)).style("opacity",.8).on("mouseover",v).on("mousemove",f).on("mouseout",x),t.selectAll("horizlines").data(m).enter().append("path").attr("stroke","black").attr("d",(t=>`\n        M${g(t.name)+p},${y(t.quartiles[1])}\n        H${g(t.name)-p}\n      `)).on("mouseover",v).on("mousemove",f).on("mouseout",x),t.selectAll("horizlines").data(m).enter().append("path").attr("stroke","black").attr("d",(t=>`\n        M${g(t.name)+p/3},${y(t.range[1])}\n        H${g(t.name)-p/3}\n      `)).on("mouseover",v).on("mousemove",f).on("mouseout",x),t.selectAll("horizlines").data(m).enter().append("path").attr("stroke","black").attr("d",(t=>`\n        M${g(t.name)+p/3},${y(t.range[0])}\n        H${g(t.name)-p/3}\n      `)).on("mouseover",v).on("mousemove",f).on("mouseout",x),t.selectAll("circle-group").data(m).enter().append("g").attr("fill",(t=>t.colourHex)).attr("fill-opacity",.5).attr("stroke","none").attr("transform",(t=>`translate(${g(t.name)}, 0)`)).selectAll("circle").data((t=>t.outliers)).enter().append("g").attr("class","circle").append("circle").attr("r","0.22em").attr("cx",(()=>0*(Math.random()-.5))).attr("cy",(t=>y(t.value))).on("mouseover",w).on("mousemove",f).on("mouseout",x)};return S(),()=>{const t=o(),e=l(t);t===c&&e===u||(c=t,u=e,p=r(c),g.range([a.left,c-a.right]),y.range([u-a.bottom,a.top]),b.selectAll("*").remove(),S())}},parseCurrency=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),parseCurrencyPlusMinus=t=>(t>=0?"+":"")+parseCurrency.format(t),getTableHTML=t=>`<table class="table" style="table-layout:fixed;"><thead><tr><th>player</th><th class="text-end">net</th><th class="text-end">buy-in</th><th class="text-end">buy-out</th></tr></thead><tbody>${t}</tbody></table>`,getTbodyHTML=(t,e)=>{let a="";for(const o of e){const e=t.players.filter((t=>t.name===o.player))[0].colourRgb.map((t=>t+.8*(255-t)));a+=`<tr style="background:rgb(${e});border-color:rgb(${e});">`,a+=`<td style="font-weight:bold">${o.player}</td>`;const l=[(n=o.delta,(n>=0?"+":"")+parseCurrency.format(n)),parseCurrency.format(o.buyin),parseCurrency.format(o.buyout)];for(const t of l)a+=`<td class="font-tabular-numbers text-end">${t}</td>`;a+="</tr>"}var n;return a},changeSelectedGame=(t,e)=>{const a=document.getElementById("selected-game-title"),n=document.getElementById("selected-game-table-date-h4"),o=document.getElementById("selected-game-table-div"),l=e.map((e=>t.games.find((t=>t.id===e)))),r=new Date(l[0].date.replace(/-/g,"/"));n.textContent=r.toLocaleDateString("en-US",{timeZone:"UTC",weekday:"long",year:"numeric",month:"long",day:"numeric"}),a.textContent=l.length>1?"Selected games":"Selected game";let s="";for(const e of l)s+=`<table class="table" style="table-layout:fixed;"><thead><tr><th>player</th><th class="text-end">net</th><th class="text-end">buy-in</th><th class="text-end">buy-out</th></tr></thead><tbody>${getTbodyHTML(t,e.data)}</tbody></table>`;o.innerHTML=s},drawCalendar=(t,e)=>{const a=17,n=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),o=d3.utcParse("%Y-%m-%d"),l=t.games.map((t=>({date:o(t.date),val:t.data.reduce(((t,e)=>t+e.buyin),0),id:t.id}))),r={},s=new Set,i=[];for(let t=0;t<l.length;t++){if(s.has(t))continue;const e=l[t].date,a=l.map(((t,a)=>t.date.getTime()===e.getTime()?a:"")).filter(String),n=a.map((t=>l[t].id));if(r[n[0]]=n.slice().reverse(),1!==a.length){for(let e=1;e<a.length;e++)l[t].val+=l[e].val,i.push(a[e]),s.add(a[e]);l[t].date=l[a[a.length-1]].date}}for(const t of i.reverse())l.splice(t,1);const d=d3.utcDays(new Date(Date.UTC(l[l.length-1].date.getFullYear(),0,1)),l[l.length-1].date),m=d3.utcDays(l[0].date,new Date(Date.UTC(l[0].date.getFullYear()+1,0,1)));m.shift();const c=[...d,...m];l.reduce(((t,e)=>{const a=d3.utcDays(e.date,t.date);return a.shift(),c.push(...a),e}));for(const t of c)l.push({date:t,val:0,id:null});l.sort(((t,e)=>e.date-t.date));const u=d3.map(l,(t=>t.date)),p=d3.map(l,(t=>t.val)),g=d3.range(u.length),y=d3.groups(g,(t=>u[t].getUTCFullYear())),b=d3.utcFormat("%b"),h=d3.scaleSqrt().domain([0,d3.max(l.map((t=>t.val)))]).range(["#ebedf0","teal"]),f=d3.select("#"+e).append("svg").attr("id","calendar-svg"),x=d3.select("#"+e).append("div").style("opacity",0).style("position","absolute").attr("class","tooltip"),v=153*y.length;f.attr("width",950).attr("height",v).attr("viewBox",[0,0,950,v]).attr("font-family","sans-serif").attr("font-size",10);const w=f.selectAll("g").data(y).join("g").attr("transform",((t,e)=>`translate(40.5,${153*e+25.5})`));w.append("text").attr("x",-5).attr("y",-5).attr("font-weight","bold").attr("text-anchor","end").text((([t])=>t)),w.append("g").attr("text-anchor","end").selectAll("text").data(d3.range(7)).join("text").attr("x",-5).attr("y",(t=>(t+.5)*a)).attr("dy","0.31em").text((t=>"SMTWRFS"[t])),w.append("g").selectAll("rect").data((([,t])=>t)).join("rect").attr("width",16).attr("height",16).attr("x",(t=>d3.utcSunday.count(d3.utcYear(u[t]),u[t])*a+.5)).attr("y",(t=>u[t].getUTCDay()*a+.5)).attr("fill",(t=>h(p[t]))).on("mouseover",((t,e)=>x.style("opacity",.8).html(`<b>${u[e].toLocaleDateString("en-US",{timeZone:"UTC",weekday:"long",year:"numeric",month:"long",day:"numeric"})}</b><br>`+(null===l[e].id?"no game":`total buy-ins: ${n.format(l[e].val)}`)))).on("mousemove",(t=>x.style("left",t.pageX+30+"px").style("top",t.pageY-20+"px"))).on("mouseout",(()=>x.style("opacity",0))).on("click",((e,a)=>{null!==l[a].id&&changeSelectedGame(t,r[l[a].id]),document.getElementById("selected-game-title").scrollIntoView()}));const S=w.append("g").selectAll("g").data((([,t])=>d3.utcMonths(u[t[t.length-1]],u[t[0]]))).join("g");S.filter(((t,e)=>e)).append("path").attr("fill","none").attr("stroke","#fff").attr("stroke-width",3).attr("d",(t=>{const e=Math.min(7,t.getUTCDay()),n=d3.utcSunday.count(d3.utcYear(t),t);return(7===e?`M${(n+1)*a},0`:`M${(n+1)*a},0V${e*a}H${n*a}`)+"V119"})),S.append("text").attr("x",(t=>d3.utcSunday.count(d3.utcYear(t),d3.utcSunday.ceil(t))*a+2)).attr("y",-5).text(b)},data={players:[{name:"David",colourHex:"#6991ce",colourRgb:[105,145,206],avatar:"https://mwiens91.github.io/poker-plots/data/avatars/david.webp",gameCount:1,cumSum:33.76,matchupData:[{player:"David",players:["David","Aidan","Bei","Juno","Zen"],gameCount:1,cumSum:33.76}],stats:{"total-money-won":33.76,"total-money-lost":0,"largest-winning-streak":{"num-games":1,total:33.76,"start-game-id":1,"end-game-id":1},"largest-losing-streak":null,"most-won-in-single-game":{total:33.76,"game-id":1},"most-lost-in-single-game":null},data:[{id:1,date:"2022-06-01",player:"David",buyin:40,buyout:73.76,delta:33.76,cumSum:33.76}]},{name:"Bei",colourHex:"#a68346",colourRgb:[166,131,70],avatar:"https://mwiens91.github.io/poker-plots/data/avatars/bei.webp",gameCount:2,cumSum:22.47,matchupData:[{player:"Bei",players:["Bei","Aidan","David","Juno","Zen"],gameCount:1,cumSum:30.12},{player:"Bei",players:["Bei","Aidan","Juno","Zen"],gameCount:1,cumSum:-7.65}],stats:{"total-money-won":30.12,"total-money-lost":7.65,"largest-winning-streak":{"num-games":1,total:30.12,"start-game-id":1,"end-game-id":1},"largest-losing-streak":{"num-games":1,total:-7.65,"start-game-id":2,"end-game-id":2},"most-won-in-single-game":{total:30.12,"game-id":1},"most-lost-in-single-game":{total:-7.65,"game-id":2}},data:[{id:1,date:"2022-06-01",player:"Bei",buyin:20,buyout:50.12,delta:30.12,cumSum:30.12},{id:2,date:"2022-06-02",player:"Bei",buyin:40,buyout:32.35,delta:-7.65,cumSum:22.47}]},{name:"Aidan",colourHex:"#7fba46",colourRgb:[127,186,70],avatar:"https://mwiens91.github.io/poker-plots/data/avatars/aidan.webp",gameCount:3,cumSum:20.4,matchupData:[{player:"Aidan",players:["Aidan","Bei","Juno","Zen"],gameCount:1,cumSum:52.05},{player:"Aidan",players:["Aidan","Bei","David","Juno","Zen"],gameCount:1,cumSum:-26.29},{player:"Aidan",players:["Aidan","Juno","Zen"],gameCount:1,cumSum:-5.36}],stats:{"total-money-won":52.05,"total-money-lost":31.65,"largest-winning-streak":{"num-games":1,total:52.05,"start-game-id":2,"end-game-id":2},"largest-losing-streak":{"num-games":1,total:-26.29,"start-game-id":1,"end-game-id":1},"most-won-in-single-game":{total:52.05,"game-id":2},"most-lost-in-single-game":{total:-26.29,"game-id":1}},data:[{id:1,date:"2022-06-01",player:"Aidan",buyin:40,buyout:13.71,delta:-26.29,cumSum:-26.29},{id:2,date:"2022-06-02",player:"Aidan",buyin:10,buyout:62.05,delta:52.05,cumSum:25.76},{id:3,date:"2022-06-19",player:"Aidan",buyin:12.5,buyout:7.14,delta:-5.36,cumSum:20.4}]},{name:"Zen",colourHex:"#d5a73c",colourRgb:[213,167,60],avatar:"https://mwiens91.github.io/poker-plots/data/avatars/zen.webp",gameCount:3,cumSum:-11.92,matchupData:[{player:"Zen",players:["Zen","Aidan","Bei","David","Juno"],gameCount:1,cumSum:-19.1},{player:"Zen",players:["Zen","Aidan","Juno"],gameCount:1,cumSum:8.23},{player:"Zen",players:["Zen","Aidan","Bei","Juno"],gameCount:1,cumSum:-1.05}],stats:{"total-money-won":8.23,"total-money-lost":20.15,"largest-winning-streak":{"num-games":1,total:8.23,"start-game-id":3,"end-game-id":3},"largest-losing-streak":{"num-games":2,total:-20.15,"start-game-id":1,"end-game-id":2},"most-won-in-single-game":{total:8.23,"game-id":3},"most-lost-in-single-game":{total:-19.1,"game-id":1}},data:[{id:1,date:"2022-06-01",player:"Zen",buyin:35.75,buyout:16.65,delta:-19.1,cumSum:-19.1},{id:2,date:"2022-06-02",player:"Zen",buyin:20,buyout:18.95,delta:-1.05,cumSum:-20.15},{id:3,date:"2022-06-19",player:"Zen",buyin:10,buyout:18.23,delta:8.23,cumSum:-11.92}]},{name:"Juno",colourHex:"#cc603e",colourRgb:[204,96,62],avatar:"https://mwiens91.github.io/poker-plots/data/avatars/juno.webp",gameCount:3,cumSum:-64.71,matchupData:[{player:"Juno",players:["Juno","Aidan","Bei","Zen"],gameCount:1,cumSum:-43.35},{player:"Juno",players:["Juno","Aidan","Bei","David","Zen"],gameCount:1,cumSum:-18.49},{player:"Juno",players:["Juno","Aidan","Zen"],gameCount:1,cumSum:-2.87}],stats:{"total-money-won":0,"total-money-lost":64.71,"largest-winning-streak":null,"largest-losing-streak":{"num-games":3,total:-64.71,"start-game-id":1,"end-game-id":3},"most-won-in-single-game":null,"most-lost-in-single-game":{total:-43.35,"game-id":2}},data:[{id:1,date:"2022-06-01",player:"Juno",buyin:80,buyout:61.51,delta:-18.49,cumSum:-18.49},{id:2,date:"2022-06-02",player:"Juno",buyin:80,buyout:36.65,delta:-43.35,cumSum:-61.84},{id:3,date:"2022-06-19",player:"Juno",buyin:30,buyout:27.13,delta:-2.87,cumSum:-64.71}]}],games:[{id:3,date:"2022-06-19",data:[{player:"Zen",buyin:10,buyout:18.23,delta:8.23},{player:"Juno",buyin:30,buyout:27.13,delta:-2.87},{player:"Aidan",buyin:12.5,buyout:7.14,delta:-5.36}]},{id:2,date:"2022-06-02",data:[{player:"Aidan",buyin:10,buyout:62.05,delta:52.05},{player:"Zen",buyin:20,buyout:18.95,delta:-1.05},{player:"Bei",buyin:40,buyout:32.35,delta:-7.65},{player:"Juno",buyin:80,buyout:36.65,delta:-43.35}]},{id:1,date:"2022-06-01",data:[{player:"David",buyin:40,buyout:73.76,delta:33.76},{player:"Bei",buyin:20,buyout:50.12,delta:30.12},{player:"Juno",buyin:80,buyout:61.51,delta:-18.49},{player:"Zen",buyin:35.75,buyout:16.65,delta:-19.1},{player:"Aidan",buyin:40,buyout:13.71,delta:-26.29}]}]},drawLinePlot=(t,e,a)=>{const n="0.14rem",o="0.23em",l=document.getElementById("main-container"),r=()=>l.clientWidth,s=t=>Math.max(Math.min(100*Math.floor(document.documentElement.clientHeight/100)-220,.65*t),.45*t);let i=!0;const d=t=>i?t.date:t.id,m=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),c=d3.utcParse("%Y-%m-%d"),u=t.players.map((t=>({...t,data:t.data.map((t=>({...t,date:c(t.date)})))}))),p=new Set;for(let e=0;e<t.games.length-1;e++){if(p.has(t.games[e].id))continue;const a=t.games.filter((a=>a.date===t.games[e].date)).map((t=>t.id));if(1!==a.length){a.reverse();for(let t=1;t<a.length;t++){const e=24*t/(a.length+1);u.forEach((n=>n.data.find((e=>e.id===a[t]))?.date.setHours(n.data[t].date.getHours()+e)))}a.forEach((t=>p.add(t)))}}const g=u.map((t=>t.data.map((t=>t.date)))).flat(),y=d3.extent(u.map((t=>t.data.map((t=>t.cumSum)))).flat()).map((t=>1.05*t)),b=[];for(const t of u){if(1===t.data.length)continue;const e=[...t.data];let a=t,n=0;for(let t=1;t<e.length;t++)e[t].id-e[t-1].id>9&&(a.data=e.slice(n,t),a={...a},a.data=e.slice(t),b.push(a),n=t)}u.push(...b);let h=r(),f=s(h);const x=d3.min(g),v=d3.max(g),w=d3.max(t.games.map((t=>t.id))),S=Math.max(1,(v.getTime()-x.getTime())/12096e5),C=Math.max(1,(w-1)/10),k=(1-.9)/(w-.9),E=(v.getTime()-x.getTime())*k/(1-k),B=new Date(Number(x));B.setTime(x.getTime()-E);let A=(i?d3.scaleUtc:d3.scaleLinear)().domain(i?[B,v]:[.9,w]).range([a.left,h-a.right-50]),$=A.copy();const I=new Proxy(new URLSearchParams(window.location.search),{get:(t,e)=>t.get(e)}).lineYScaleExponent,M=d3.scalePow().exponent(null===I?1:parseFloat(I)).domain(y).range([f-a.bottom,a.top]),P=d3.select("#"+e).append("svg"),D=d3.select("#line-plot-avatar-div"),H=d3.select("#line-plot-player-div"),T=d3.select("#line-plot-game-div"),U=d3.select("#line-plot-avatar"),L=d3.select("#line-plot-player"),Z=d3.select("#line-plot-amount"),F=d3.select("#line-plot-game-title"),W=d3.select("#line-plot-game-info"),J=(t,e)=>{P.selectAll(".line").style("opacity",.15),P.selectAll(".circle").style("opacity",.15),P.selectAll(".line").filter((e=>e.name===t)).style("opacity",.7).style("stroke-width","0.18rem").style("cursor",(()=>e?"pointer":"none")),P.selectAll(".circle").filter((e=>e.player===t)).style("opacity",.85)},z=()=>{P.selectAll(".line").style("opacity",.6).style("stroke-width",n).style("cursor","none"),P.selectAll(".circle").style("opacity",.85)},R=t=>{D.style("background","rgb("+t.colourRgb.map((t=>t+.17*(255-t)))+")"),H.style("background","rgb("+t.colourRgb.map((t=>t+.4*(255-t)))+")"),U.attr("src",t.avatar),L.text(t.name),Z.text(m.format(t.cumSum))};for(const t of u){const e=document.getElementById("legend-icon-div-"+t.name);e.addEventListener("mouseover",(()=>{J(t.name,!1),R(t)})),e.addEventListener("mouseout",z)}let q,Y,N,V;P.attr("preserveAspectRatio","xMinYMin meet").attr("viewBox",[0,0,h,f]);const G=d3.zoom().scaleExtent(i?[.7,S]:[.7,C]).on("zoom",(({transform:t})=>{A=t.rescaleX($),q.scale(A),Y.call(q),N.selectAll("circle").attr("cx",(t=>A(d(t)))),N.selectAll("path").attr("d",(t=>V(t.data)))}));P.call(G).on("wheel",(t=>t.preventDefault())).on("dblclick.zoom",null).on("dblclick",(()=>{i=!i,A=(i?d3.scaleUtc:d3.scaleLinear)().domain(i?[B,v]:[.9,w]).range([a.left,h-a.right-50]),$=A.copy(),i?G.scaleExtent([.7,S]):G.scaleExtent([.7,C]),q.scale(A),Y.transition().call(q),N.selectAll("circle").transition().attr("cx",(t=>A(d(t)))),N.selectAll("path").transition().attr("d",(t=>V(t.data))).on("end",(()=>P.call(G.transform,d3.zoomIdentity)))}));const j=()=>{const e=P.append("g").attr("transform",`translate(${a.left}, ${a.top})`);q=d3.axisBottom(A);const l=d3.axisLeft(M).tickFormat((t=>m.format(t))).ticks(13),r=d3.axisLeft(M).tickSize(a.left+a.right-h).tickFormat("").ticks(13).tickSizeOuter(0);e.append("g").attr("class","y axis-grid").attr("transform",`translate(${a.left}, 0)`).call(r),Y=e.append("g").attr("class","x axis").attr("transform",`translate(0, ${f-a.bottom})`).call(q),e.append("g").attr("class","y axis").attr("transform",`translate(${a.left}, 0)`).call(l).append("text").attr("y",15).attr("transform","rotate(-90) translate(-10, 0.2)").attr("fill","#000").text("cumulative sum (CAD)"),e.append("defs").append("svg:clipPath").attr("id","clip").append("svg:rect").attr("width",h-a.left-a.right).attr("height",f-a.top-a.bottom).attr("x",a.left).attr("y",a.top),N=e.append("g").attr("clip-path","url(#clip)"),V=d3.line().x((t=>A(d(t)))).y((t=>M(t.cumSum)));const s=N.append("g").attr("class","lines");s.selectAll(".line-group").data(u).enter().append("g").attr("class","line-group").append("path").attr("class","line").attr("d",(t=>V(t.data))).style("stroke",(t=>t.colourHex)).style("stroke-width",n).style("opacity",.6).on("mouseover",((t,e)=>{J(e.name,!0),R(e)})).on("mouseout",z),s.selectAll("circle-group").data(u).enter().append("g").style("fill",(t=>t.colourHex)).selectAll("circle").data((t=>t.data)).enter().append("g").attr("class","circle").append("circle").attr("cx",(t=>A(d(t)))).attr("cy",(t=>M(t.cumSum))).attr("r",o).style("opacity",.85).on("mouseover",((t,e)=>{d3.select(t.currentTarget).transition().attr("r","0.46em").style("cursor","pointer");const a=u.find((t=>t.name===e.player));R(a),T.style("background","rgb("+a.colourRgb.map((t=>t+.8*(255-t)))+")"),F.text(e.date.toLocaleDateString("en-US",{timeZone:"UTC",weekday:"long",year:"numeric",month:"long",day:"numeric"})),W.html("Σ="+m.format(e.cumSum)+"&nbsp;&nbsp; Δ="+m.format(e.delta)+"&nbsp;&nbsp; ↧"+m.format(e.buyin)+"&nbsp;&nbsp; ↥"+m.format(e.buyout))})).on("mouseout",(t=>{d3.select(t.currentTarget).transition().attr("r",o).style("cursor","none"),T.style("background","#FFFFFF"),F.text(""),W.text("")})).on("click",((e,a)=>{changeSelectedGame(t,[a.id]),document.getElementById("selected-game-div").scrollIntoView()}))};return j(),()=>{const t=r(),e=s(t);if(t!==h||e!==f){const n=(t-a.left-a.right)/(h-a.left-a.right);h=t,f=e;const o=d3.zoomTransform(P.node());P.call(G.transform,d3.zoomIdentity),P.attr("viewBox",[0,0,h,f]),A.range([a.left,h-a.right-50]),$=A.copy(),M.range([f-a.bottom,a.top]),P.selectAll("*").remove(),j(),o.x*=n,o.y*=n,P.call(G.transform,o)}}},initializePeopleSection=t=>{const e=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),a=document.getElementById("people-body-avatar"),n=document.getElementById("people-body-player-title-name"),o=document.getElementById("people-body-player-title-divider"),l=document.getElementById("people-body-player-title-cumsum"),r=document.getElementById("people-body-hr"),s=document.getElementById("people-body-games-played"),i=document.getElementById("people-body-total-money-won"),d=document.getElementById("people-body-total-money-lost"),m=document.getElementById("people-body-most-money-won-consecutive-main"),c=document.getElementById("people-body-most-money-won-consecutive-sub"),u=document.getElementById("people-body-most-money-lost-consecutive-main"),p=document.getElementById("people-body-most-money-lost-consecutive-sub"),g=document.getElementById("people-body-most-money-won-single-main"),y=document.getElementById("people-body-most-money-won-single-sub"),b=document.getElementById("people-body-most-money-lost-single-main"),h=document.getElementById("people-body-most-money-lost-single-sub"),f=document.getElementById("people-matchups-div"),x=x=>{a.setAttribute("src",x.avatar),n.textContent=x.name,o.style.color=x.colourHex,l.textContent=e.format(x.cumSum),r.style.backgroundColor=x.colourHex,s.textContent=x.gameCount,i.textContent=e.format(x.stats["total-money-won"]),d.textContent=e.format(x.stats["total-money-lost"]),null===x.stats["largest-winning-streak"]?(m.textContent="?",c.textContent=x.name+" has never won a game"):1===x.stats["largest-winning-streak"]["num-games"]?(m.textContent="?",c.textContent=x.name+" has never won consecutive games"):(m.textContent=e.format(x.stats["largest-winning-streak"].total),c.textContent="on "+t.games.find((t=>t.id===x.stats["largest-winning-streak"]["start-game-id"])).date+" through "+t.games.find((t=>t.id===x.stats["largest-winning-streak"]["end-game-id"])).date+" ("+x.stats["largest-winning-streak"]["num-games"]+" games)"),null===x.stats["largest-losing-streak"]?(u.textContent="?",p.textContent=x.name+" has never lost a game"):1===x.stats["largest-losing-streak"]["num-games"]?(u.textContent="?",p.textContent=x.name+" has never lost consecutive games"):(u.textContent=e.format(-x.stats["largest-losing-streak"].total),p.textContent="on "+t.games.find((t=>t.id===x.stats["largest-losing-streak"]["start-game-id"])).date+" through "+t.games.find((t=>t.id===x.stats["largest-losing-streak"]["end-game-id"])).date+" ("+x.stats["largest-losing-streak"]["num-games"]+" games)"),null===x.stats["most-won-in-single-game"]?(g.textContent="?",y.textContent=x.name+" has never won a game"):(g.textContent=e.format(x.stats["most-won-in-single-game"].total),y.textContent="on "+t.games.find((t=>t.id===x.stats["most-won-in-single-game"]["game-id"])).date),null===x.stats["most-lost-in-single-game"]?(b.textContent="?",h.textContent=x.name+" has never lost a game"):(b.textContent=e.format(-x.stats["most-lost-in-single-game"].total),h.textContent="on "+t.games.find((t=>t.id===x.stats["most-lost-in-single-game"]["game-id"])).date),f.innerHTML="";for(const[t,a]of x.matchupData.entries()){if(t>5)break;const n=document.createElement("div");n.classList.add("people-matchup-div"),n.style.background="rgb("+x.colourRgb.map((t=>t+.7*(255-t)))+")",n.innerHTML=`<div style="padding-bottom: 6px"><b>${a.players.join(", ")}</b><br><em>${a.gameCount} game${a.gameCount>1?"s":""}, ${a.players.length} players</em></div><span style="font-size: 16px"<>${e.format(a.cumSum)}</span>`,f.appendChild(n)}};for(const e of t.players){document.getElementById("people-icon-div-"+e.name).addEventListener("mouseover",(()=>x(e)))}let v=t.players.filter((t=>t.gameCount>=3));0===v.length&&(v=t.players);const w=v[Math.floor(Math.random()*v.length)];return x(w),w.name},drawPiePlot=(t,e,a)=>{const n=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),o=d3.select("#"+e).append("svg"),l=d3.pie().value((t=>Math.abs(t.cumSum)))(t),r=t.reduce(((t,e)=>t+e.cumSum),0),s=d3.select("#"+e).append("div").style("opacity",0).style("position","absolute").attr("class","tooltip"),i=t=>s.style("left",t.pageX+30+"px").style("top",t.pageY-20+"px"),d=()=>s.style("opacity",0),m=(t,e)=>s.style("opacity",.8).html(`<b>${e.data.name}</b><br>cumulative sum: ${n.format(e.data.cumSum)}<br>percent total ${e.data.cumSum>0?"winnings":"losses"}: ${Math.round(e.data.cumSum/r*100*10)/10}%`),c=document.getElementById(e),u=()=>c.clientWidth;let p=u();const g=()=>{const t=Math.min(p/2-a.left,p/2-a.right,p/2-a.top,p/2-a.bottom),e=2*t,n=o.attr("viewBox",[0,0,p,e]).append("g").attr("transform",`translate(${p/2}, ${e/2})`),r=d3.arc().innerRadius(.5*t).outerRadius(.8*t),s=d3.arc().innerRadius(.9*t).outerRadius(.9*t);n.selectAll("g.slice").data(l).enter().append("g").append("path").attr("d",r).attr("fill",(t=>t.data.colourHex)).attr("stroke","white").style("stroke-width","2px").style("opacity",.7).on("mouseover",m).on("mousemove",i).on("mouseout",d);const c=t=>t.startAngle+(t.endAngle-t.startAngle)/2,u=n.selectAll("g.slice").data(l.filter((t=>t.endAngle-t.startAngle>.22))).enter().append("g");u.append("polyline").attr("stroke","black").style("fill","none").attr("stroke-width",1).attr("points",(function(e){const a=r.centroid(e),n=s.centroid(e),o=s.centroid(e);return o[0]=.95*t*(c(e)<Math.PI?1:-1),[a,n,o]})).on("mouseover",m).on("mousemove",i).on("mouseout",d),u.append("text").attr("transform",(e=>{const a=s.centroid(e);return a[0]=.99*t*(c(e)<Math.PI?1:-1),"translate("+a+")"})).style("text-anchor",(t=>c(t)<Math.PI?"start":"end")).text((t=>t.data.name)).on("mouseover",m).on("mousemove",i).on("mouseout",d)};return g(),()=>{const t=u();t!==p&&(p=t,o.selectAll("*").remove(),g())}};initializePeopleSection(data);const linePlotMargin={top:10,bottom:40,left:35,right:35},boxPlotMargin={top:20,bottom:40,left:35,right:35},piePlotMargin={top:0,bottom:0,left:47,right:47},redrawLinePlot=drawLinePlot(data,"line-plot-parent",linePlotMargin),redrawBoxPlot=drawBoxPlot(data.players,"box-plot-parent",boxPlotMargin),redrawWinnerPiePlot=drawPiePlot(data.players.filter((t=>t.cumSum>0)),"winner-pie-chart-parent",piePlotMargin),redrawLoserPiePlot=drawPiePlot(data.players.filter((t=>t.cumSum<0)),"loser-pie-chart-parent",piePlotMargin);drawCalendar(data,"calendar-parent");const MIN_ACCEPTABLE_WIDTH=992,containerElement=document.getElementById("main-container"),calendarElement=document.getElementById("calendar"),alertBoxElement=document.getElementById("alert-box"),pageUpCircleElement=document.getElementById("page-up-circle"),pageUpCircleNormalTopMargin=parseInt(getComputedStyle(pageUpCircleElement).marginTop.slice(0,-2)),narrowViewportHandle=t=>{t<992?(calendarElement.style.display="none",alertBoxElement.style.display="block",pageUpCircleElement.style.marginTop=pageUpCircleNormalTopMargin+Math.round(alertBoxElement.offsetHeight)+"px"):(calendarElement.style.display="block",alertBoxElement.style.display="none",pageUpCircleElement.style.marginTop=pageUpCircleNormalTopMargin+"px")};narrowViewportHandle(document.documentElement.clientWidth);let prevContainerWidth=containerElement.clientWidth,prevWindowWidth=document.documentElement.clientWidth,prevWindowHeightFloored=100*Math.floor(document.documentElement.clientHeight/100);const windowResizeListener=()=>{const t=document.documentElement.clientHeight,e=document.documentElement.clientWidth,a=containerElement.clientWidth,n=100*Math.floor(t/100);(e-992)*(prevWindowWidth-992)<=0&&(prevWindowWidth=e,narrowViewportHandle(e));let o=!1,l=!1;a!==prevContainerWidth&&(prevContainerWidth=a,o=!0),n!==prevWindowHeightFloored&&(prevWindowHeightFloored=n,l=!0),o?(redrawLinePlot(),redrawBoxPlot(),redrawWinnerPiePlot(),redrawLoserPiePlot()):l&&(redrawLinePlot(),redrawBoxPlot())};window.addEventListener("resize",windowResizeListener);const circleElement=document.getElementById("page-up-circle"),observer=new IntersectionObserver((t=>{t[0].isIntersecting?circleElement.style.display="block":circleElement.style.display="none"}),{rootMargin:"0px 0px -100% 0px",threshold:[0]});observer.observe(document.getElementById("page-up-circle-trigger"));const expandGamesButtonElement=document.getElementById("expand-games-button"),collapseGamesElement=document.getElementById("collapse-games");expandGamesButtonElement.onclick=()=>{collapseGamesElement.offsetHeight>100&&collapseGamesElement.scrollIntoView()};
